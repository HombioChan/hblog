## 序言
In a distributed system (a collection of interconnected nodes that share data.), you can only have two out of the following three guarantees across a write/read pair: Consistency, Availability, and Partition Tolerance - one of them must be sacrificed.

在一个分布式系统中（指**互相连接并共享数据**的节点），当涉及**某数据**的读写操作时，只能保证一致性、可用性、分区容错性三者中的两个，另外一个必须要被牺牲。

### 一致性
对某个指定的客户端来说，读操作保证可以返回最新的写操作结果。

### 可用性
非故障节点在合理的时间内返回合理的结果（不是错误或超时）

### 分区容错性
当网络出现分区后，系统能够继续履行职责。

### CAP应用
指导分布式系统设计（指**互相连接并共享数据**的节点）
- 如果不发生网络分区，可满足 CA
- 如果发生网络分区，只能满足 CP 或者 AP
- 网络分区后，采取补偿措施再次满足 CA

#### CP
如果节点A和B的复制通道中断，节点A的数据无法同步到节点B，为了保证数据一致性，当读请求到达节点B时，必选返回错误，这显然违背了可用性定义。
```
A ---\----> B
```

#### AP
如果节点A和B的复制通道中断，节点A的数据无法同步到节点B，为了保证可用性，当读请求到达节点B时，必须返回一个合理的结果，但是该结果不是最新的数据，不满足一致性定义。
```
A ---\----> B
```

#### CAP 关注的粒度是数据，不是整个系统
C 与 A 之间的取舍可以在同一系统内以非常细小的粒度反复发生，而每一次的决策可能因为具体的操作，乃至因为牵涉到特定的数据或用户而有所不同。

#### CAP 是忽略网络延时的
也就是说，CAP 中的 C 在实践中是不可能完美实现的，所以，对于要求强一致性的业务数据，只能做主备，即读写请求只能路由到同一台数据库服务器，此时数据是不共享的，所以CAP理论不适用了。

#### 正常情况下，可以同时满足AP
CAP理论声明分布式系统只能选择 CP 或者 AP，那是在假设分区错误必然发生的前提下，如果系统没发生分区错误，也就是 P 不存在，是可以同时满足 CA 的。

#### 牺牲不意味着什么都不做，要为分区恢复后做准备
在分区恢复之后，要有补偿措施使系统恢复到CA。

### BASE
- Basically Available: 分布式系统出现故障时，允许损失部分可用性，保证核心功能可用
- Soft State: 允许存在中间状态（即数据不一致），而该中间状态不会影响系统的可用性
- Eventual Consistency：系统中所有副本，经过一定时间后，最终可以达到一致的状态

BASE 理论是对 AP 方案的一个补充。